<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>404 - 人机五子棋</title>
<style>
*{margin:0;padding:0;border:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:#f7f8fa;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}
body{display:flex;align-items:center;justify-content:center;padding:10px}
#game{position:fixed;inset:0;margin:auto;width:90vmin;height:90vmin;background:#fff;border:2px solid #4a79e2;border-radius:10px}
.ui{position:fixed;top:10px;left:0;right:0;text-align:center}
.title{font-size:48px;font-weight:700;color:#4a79e2}
.desc{font-size:15px;color:#666;margin-top:4px}
.buttons{position:fixed;bottom:12px;left:0;right:0;display:flex;gap:10px;justify-content:center}
.btn{padding:10px 18px;background:#4a79e2;color:#fff;border-radius:6px;text-decoration:none;font-size:14px}
.gray{background:#666}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="ui">
  <div class="title">404</div>
  <div class="desc">页面走丢啦，和AI下盘五子棋</div>
</div>
<div class="buttons">
  <button id="restart" class="btn gray">重新开始</button>
  <a class="btn" href="/">返回首页</a>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const size = 15;
let board, current, over;
const USER = 1, AI = 2;

function init(){
  board = Array.from({length:size},()=>Array(size).fill(0));
  current = USER; over = false;
  resize(); render();
}

function resize(){
  const d = Math.floor(Math.min(canvas.offsetWidth,canvas.offsetHeight));
  canvas.width = d; canvas.height = d;
}

function g(){return canvas.width/size}
function drawBoard(){
  const gs = g(); ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.strokeStyle='#ccc';
  for(let i=0;i<=size;i++){
    ctx.beginPath(); ctx.moveTo(i*gs,0); ctx.lineTo(i*gs,canvas.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0,i*gs); ctx.lineTo(canvas.width,i*gs); ctx.stroke();
  }
}

function drawPiece(x,y,c){
  const gs=g(); const cx=(x+0.5)*gs, cy=(y+0.5)*gs;
  ctx.beginPath(); ctx.arc(cx,cy,gs*0.4,0,Math.PI*2);
  ctx.fillStyle=c===USER?'#000':'#fff'; ctx.fill();
  ctx.strokeStyle='#333'; ctx.stroke();
}

function render(){
  drawBoard();
  for(let i=0;i<size;i++) for(let j=0;j<size;j++){
    if(board[i][j]===USER) drawPiece(i,j,USER);
    if(board[i][j]===AI) drawPiece(i,j,AI);
  }
}

function checkWin(x,y,p){
  const dir=[[1,0],[0,1],[1,1],[1,-1]];
  for(let [dx,dy] of dir){
    let cnt=1;
    for(let i=1;i<5;i++){const nx=x+dx*i,ny=y+dy*i; if(nx>=0&&nx<size&&ny>=0&&ny<size&&board[nx][ny]===p)cnt++;else break}
    for(let i=1;i<5;i++){const nx=x-dx*i,ny=y-dy*i; if(nx>=0&&nx<size&&ny>=0&&ny<size&&board[nx][ny]===p)cnt++;else break}
    if(cnt>=5)return 1;
  }
  return 0;
}

function place(x,y){
  if(over||board[x][y]!==0)return;
  board[x][y]=current; render();
  if(checkWin(x,y,current)){
    setTimeout(()=>alert(current===USER?'你赢了！':'AI赢了'),100);
    over=1; return;
  }
  current=current===USER?AI:USER;
  if(current===AI&&!over) setTimeout(aiGo,300);
}

function evalLine(x,y,dx,dy,p){
  let c=0;
  for(let i=1;i<5;i++){const nx=x+dx*i,ny=y+dy*i; if(nx>=0&&nx<size&&ny>=0&&ny<size&&board[nx][ny]===p)c++;else break}
  for(let i=1;i<5;i++){const nx=x-dx*i,ny=y-dy*i; if(nx>=0&&nx<size&&ny>=0&&ny<size&&board[nx][ny]===p)c++;else break}
  return c;
}

function evalPos(x,y){
  let s=0;
  board[x][y]=AI; if(checkWin(x,y,AI))s+=10000; board[x][y]=0;
  board[x][y]=USER; if(checkWin(x,y,USER))s+=5000; board[x][y]=0;
  const dir=[[1,0],[0,1],[1,1],[1,-1]];
  for(let [dx,dy] of dir){
    s+=evalLine(x,y,dx,dy,AI)*10;
    s+=evalLine(x,y,dx,dy,USER)*8;
  }
  return s;
}

function aiGo(){
  let mx=-1, bx=0, by=0;
  for(let i=0;i<size;i++)for(let j=0;j<size;j++){
    if(board[i][j]!==0)continue;
    const sc=evalPos(i,j);
    if(sc>mx)mx=sc,bx=i,by=j;
  }
  place(bx,by);
}

function pos(e){
  const r=canvas.getBoundingClientRect();
  const x=Math.floor((e.clientX-r.left)/g());
  const y=Math.floor((e.clientY-r.top)/g());
  return [x,y];
}

canvas.addEventListener('click',e=>{
  if(current!==USER)return;
  const [x,y]=pos(e);
  if(x>=0&&x<size&&y>=0&&y<size)place(x,y);
});

canvas.addEventListener('touchstart',e=>{
  e.preventDefault();
  if(current!==USER)return;
  const [x,y]=pos(e.touches[0]);
  if(x>=0&&x<size&&y>=0&&y<size)place(x,y);
});

document.getElementById('restart').onclick=init;
window.addEventListener('resize',()=>{resize();render()});
init();
</script>
</body>
</html>
